<h2>Class <%= @clazz.inspect %></h2>

<form class="form-horizontal well" action="/ClassExplorer">
  <div class="control-group">
    <legend>Filter results</legend>
    <label class="control-label" for="id">Object ID of class</label>
    <div class="controls">
      <input type="text" id="id" name="id" value="<%= @clazz.object_id %>">
    </div>
    <br/>
    <label class="control-label" for="maxItems">Limit instances</label>
    <div class="controls">
      <input type="text" id="maxItems" name="maxItems" value="<%= @max_items %>">
    </div>
    <br/>
    <label class="control-label" for="showIvs">Show instance variables</label>
    <div class="controls">
      <input type="text" id="showIvs" name="showIvs" value="<%= @show_ivs %>">
      <br/><br/>
      <button type="submit" class="btn">Filter</button>
    </div>
  </div>
</form>

<p>Output limited to <%= @max_items %> instances.</p>

<table class="table table-striped table-bordered">
  <tr>
    <th>object_id</th>
    <th>object</th>
    <% @ivs.each do |iv_name| %>
      <th><%= iv_name %></th> 
    <% end %>
  </tr>

  <% @objs.each do |obj| %>
    <tr>
      <td><%= obj.object_id %></td>
      <td><%= render(:partial => "shared/object", :locals => {:object => obj}) %></td>
      <% @ivs.each do |iv_name| %>
        <td>
          <% if obj.instance_variable_defined?(iv_name) %>
            <%= render(:partial => "shared/object", :locals => {:object => obj.instance_variable_get(iv_name)}) %>
          <% else %>
            (n/a)
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>

<script>
  $(document).ready(function () {
    
    $(".form-print-it").each(function(formIndex, form) {
      $(form).find("input[type=text]").keyup(function (e) {
        if (e.keyCode == 13) {
          var data = $(form).serialize();
          var language = $(form).data("language");
          var textField = $(form).find("#code");
          var divContainer = $(form).parent().find(".container-print-it-" + language + "-result");

          textField.prop("disabled", true);
          divContainer.removeClass("alert-success alert-error alert");
          divContainer.html("<b class=\"icon-refresh\"></b> Waiting...");

          $.post("/PrintIt/" + language, data, function(response) {
            if (response.status == "ok") {
              $.post("/ObjectExplorer/table", {"id": response.result}, function(response) {
                divContainer.html(response);
                divContainer.addClass("alert-success")
              });
            }
            else if (response.status == "exception") {
              divContainer.text(response.result);
              divContainer.addClass("alert-error");
            }
          });
          textField.prop("disabled", false);
          divContainer.addClass("alert");
          console.log(data);    
        }
      });
    });

    $(window).keydown(function(event){
      if(event.keyCode == 13) {
        event.preventDefault();
        return false;
      }
    });

  });
</script>
